<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Viartual Assistent</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="AssistBot.css" type="text/css">
		<style>
			body{padding:0;margin:0;background-color:white;}
			canvas{float:left;border:0;padding:0;margin:0;display:block}
			.botui-app-container3D{position:fixed;top:0;height:100%;left:424px;right:0;z-index:9999;background-color:white}
			.botui-scroller3D{display:block;width:100%;height:100%;overflow-y:hidden}
			.demo-starter{position:fixed;left:0;right:0;top:0;bottom:0;background-color:silver;z-index:10000}
			.demo-starter-label{position:fixed;top:0;bottom:0;left:0;right:0;margin:auto auto;width:auto;height:100px;text-align:center;font-family:Arial;font-size:36px;font-weight:bold;cursor:default}
			.pleasewait_container{position:fixed;left:0;top:0;right:0;bottom:0;background-color:black;z-index:99999}
			.pleasewait{position:fixed;width:64px;height:64px;left:0;right:0;top:0;bottom:0;margin:auto auto;border:0;z-index:9}
			.lds-spinner{color:white;display:inline-block;position:relative;width:64px;height:64px}
			.lds-spinner div{transform-origin:32px 32px;animation:lds-spinner 1.2s linear infinite}
			.lds-spinner div:after{content:" ";display:block;position:absolute;top:3px;left:29px;width:5px;height:14px;border-radius:20%;background:white}
			.lds-spinner div:nth-child(1){transform:rotate(0deg);animation-delay:-1.1s}
			.lds-spinner div:nth-child(2){transform:rotate(30deg);animation-delay:-1s}
			.lds-spinner div:nth-child(3){transform:rotate(60deg);animation-delay:-0.9s}
			.lds-spinner div:nth-child(4){transform:rotate(90deg);animation-delay:-0.8s}
			.lds-spinner div:nth-child(5){transform:rotate(120deg);animation-delay:-0.7s}
			.lds-spinner div:nth-child(6){transform:rotate(150deg);animation-delay:-0.6s}
			.lds-spinner div:nth-child(7){transform:rotate(180deg);animation-delay:-0.5s}
			.lds-spinner div:nth-child(8){transform:rotate(210deg);animation-delay:-0.4s}
			.lds-spinner div:nth-child(9){transform:rotate(240deg);animation-delay:-0.3s}
			.lds-spinner div:nth-child(10){transform:rotate(270deg);animation-delay:-0.2s}
			.lds-spinner div:nth-child(11){transform:rotate(300deg);animation-delay:-0.1s}
			.lds-spinner div:nth-child(12){transform:rotate(330deg);animation-delay:0s}
			@keyframes lds-spinner{0%{opacity:1}100%{opacity:0}}

			@media only screen and (orientation:portrait)
				{
				.botui-app-container3D{background-color:red;position:fixed;top:unset;bottom:0;height:230px !important;left:0 !important;right:0;z-index:9999;background-color:white}
				.demo-starter-label{font-size:30px}
				}

		</style>
	</head>
	<body>
		<canvas id="threeCanvas"></canvas>
		<div class="botui-app-container3D" id="AssistBot">
			<div class="botui-scroller3D" id="botui-scroller">
				<bot-ui></bot-ui>
			</div>
		</div>
		<div class="demo-starter"><span class="demo-starter-label"></span></div>
		<div class="pleasewait_container"><div class="pleasewait" id="loading"><div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>

		<script type="text/javascript" src="assistent.js"></script>
		<script type="text/javascript" src="AssistBot.min.js"></script>
		<script type="text/javascript" src="/serverportal/addons/jquery/jquery-3.6.0.min.js"></script>
		<script type="text/javascript" src="../../metro/js/metro.min.js"></script>
		<script>

			var homeBot = BotUI("AssistBot");

			let menuName = "";
			let question = "";

			textStart = "click to START Virtual Assistant";
			textWelcome = "Hello, I'm the virtual assistant of this Website. Which menu do you have a question about?";
			textInputQuestion = "Write your Question...";
			textSend = "Send";


			document.getElementsByClassName("demo-starter-label")[0].innerHTML = textStart;

			function Step1(a) {
				console.log(a);
				homeBot.message.add({
					delay: 1200,
					loading: true,
					photo: true,
					content: a
				}).then(function () {
					speak(onlyText(a));
					return homeBot.action.text({
						delay: 800,
						action: { value: "", placeholder: "Write Menu Name...", button: { label: "Confirm" } },
					});
				}).then(function (res) {
					homeBot.message.add({ human: true, photo: true, content: res.value });
					if (res.value.trim() == "") {
						surpriseFace();
						Step1("Write Menu Name please");
					} else {
						menuName = res.value;
						Step2(textInputQuestion);
					}
				});
			}


			function Step2(a) {
				homeBot.message.add({
					delay: 1200,
					loading: true,
					photo: true,
					content: a
				}).then(function () {
					speak(onlyText(a));
					return homeBot.action.text({
						delay: 800,
						action: { value: "", placeholder: "Write your Question...", button: { label: textSend } },
					});
				}).then(function (res) {
					homeBot.message.add({ human: true, photo: true, content: res.value });
					if (res.value.trim() == "") {
						surpriseFace();
						Step2(textInputQuestion + " please");
					} else {
						question = res.value;
						Step3("The Question was sent");
					}
				});
			}

			function Step3() {
				SetQuestionList();
				happyFace();
				Step1("Your Question was sent. Do you have any other questions ? ");
			}

			function onlyText(a) {
				var div = document.createElement("div");
				div.innerHTML = a;
				return div.textContent || div.innerText || "";
			}

			function SetQuestionList() {
				$.ajax({
					global: false,
					type: "POST",
                    url: Metro.storage.getItem('BackendServerAddress', null) + "/PortalApiTableService/SetQuestionList",
					async: true,
					cache: false,
                    headers: JSON.parse(JSON.stringify(Metro.storage.getItem("ApiToken", null))) != null ? { 'Content-type': 'application/json charset=UTF-8', 'Authorization': 'Bearer ' + Metro.storage.getItem('ApiToken', null).Token } : { 'Content-type': 'application/json' },
					contentType: "application/json; charset=utf-8",
					data: JSON.stringify({ MenuName: menuName, Question: question }),
					dataType: "json",
					success: function (result) {
						return true;
					},
					error: function (err) {
						return false;
					}
				});
			}
		</script>
	</body>
</html>