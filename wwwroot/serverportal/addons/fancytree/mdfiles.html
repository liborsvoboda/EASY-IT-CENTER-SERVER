<html>
<head>
	<meta name="robots" content="noindex,follow">
	<meta name="charset" content="utf-8" />

	<link rel="stylesheet" href="/serverportal/addons/fancytree/dist/skin-win8/ui.fancytree.min.css">
	<link rel="stylesheet" href="/serverportal/addons/fancytree/extensions/contextmenu/jquery.contextMenu.min.css" />
	<link rel="stylesheet" href="../../metro/css/metro-all.css" />

	<script type="text/javascript" src="/serverportal/addons/jquery/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/serverportal/addons/fancytree/dist/fancytree-all-deps.js"></script>
	<script type="text/javascript" src="/serverportal/addons/fancytree/extensions/contextmenu/js/jquery.contextMenu.min.js"></script>
	<script type="text/javascript" src="/serverportal/addons/fancytree/extensions/contextmenu/js/jquery.fancytree.contextMenu.js"></script>
	<script type="text/javascript" src="../../metro/js/metro.min.js"></script>

	<script type="text/javascript" src="/serverportal/manage/js/global-storage.js"></script>
	<script type="text/javascript" src="/serverportal/manage/js/global-behavior.js"></script>
	<script type="text/javascript" src="/serverportal/manage/js/global-object.js"></script>
	<script type="text/javascript" src="/serverportal/manage/js/global-functions.js"></script>
	<script type="text/javascript" src="/serverportal/manage/js/global-api.js"></script>

	<script type="text/javascript" src="/serverportal/manage/js/js.cookie.min.js"></script>
	<title>Help Files Browser</title>
	<script type="text/javascript"></script>
</head>
<body>
	<div class="row w-100 h-100 d-inline-flex">
		<div id="DataTree" class="h-100" style="width: 350px; overflow-y: auto; padding-top: 25px;"></div>
		<div id="FrameWindow" class="h-100 row" height="100%" frameborder="0" scrolling="yes" style="width: calc(100% - 350px); height: 100%; position: relative; padding-top: 25px;">
		</div>

		<div id="ActionMenu" class="w-100 pos-fixed" style="z-index: 9999999999;">
			<nav data-role="ribbonmenu">
				<ul class="tabs-holder">
					<li onclick="ReloadUserHelpFiles()" class=""><a href="#">User Help Files</a></li>
					<li onclick="ReloadGuestHelpFiles()" class=""><a href="#">Guest Help Files</a></li>
					<li onclick="EditHelpFiles()" class=""><a href="#">Edit Selected File</a></li>
				</ul>
		</div>
	</div>
	<script type="text/javascript">
		function ReloadUserHelpFiles() {
            $('#DataTree').fancytree('option', 'source', { url: "/JsonGeneratorService/GetFancyUserMDFiles" });
		}
        function ReloadGuestHelpFiles() {
            $('#DataTree').fancytree('option', 'source', { url: "/JsonGeneratorService/GetFancyGuestMDFiles" });
        }
		function EditHelpFiles() {
			Gs.Behaviors.ShowPageLoading();
			$("#FrameWindow").html("<iframe id=IFrameWindow src='/serverportal/addons/markdown/index.html' class='h-100' height='100%' frameborder='0' scrolling='yes' style='width:100%; height:calc(100vh);' ></iframe>");
			setTimeout(function () {
				if ($('#DataTree').fancytree("getActiveNode") != null) { $('#IFrameWindow')[0].contentWindow.mdEditor.setMarkdown($('#DataTree').fancytree("getActiveNode").data.content); }
                Gs.Behaviors.HidePageLoading();
			}, 3000);
			
        }

		$(function () {
			$("#DataTree").fancytree({
                extensions: ["contextMenu"],
                checkbox: false,
                quicksearch: true,
				source: {
                    url: "/JsonGeneratorService/GetFancyUserMDFiles"
				},
				activate: function (event, data) {
                    Gs.Behaviors.ShowPageLoading();
					$("#FrameWindow").html("<iframe id=IFrameWindow src='" + data.node.key + "' class='h-100' height='100%' frameborder='0' scrolling='yes' style='width:100%; height: 100%;' ></iframe>");
                    document.getElementById('IFrameWindow').onload = function () {
                        Gs.Behaviors.HidePageLoading();
                    };
				},
				checkbox: function (event, data) {
					return data.node.isFolder() ? false : false;
				},
				contextMenu: {
					autoFocus: true,
					menu: function (node) {
						return {
							"saveFile": { "name": "Save File", "icon": "paste" },
						};
					},
                    actions: function (node, action, options) {
                        if (action == "saveFile") {
                            Gs.Apis.RunServerPostApi("UserStorageService/SetUserTextFile", {
                                Path: $('#DataTree').fancytree("getActiveNode").data.path,
                                Content: $('#IFrameWindow')[0].contentWindow.mdEditor.getMarkdown()
							});
                            setTimeout(function () {
                                ReloadUserHelpFiles();
                            }, 2000);
							
                        }
                    }
				},
				
			});
		});

	</script>
</body>

</html>