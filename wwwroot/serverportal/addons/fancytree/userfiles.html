<html>
<head>
    <meta name="robots" content="noindex,follow">
    <meta name="charset" content="utf-8" />

    <link rel="stylesheet" href="/serverportal/addons/fancytree/dist/skin-win8/ui.fancytree.min.css">
    <link rel="stylesheet" href="/serverportal/addons/fancytree/extensions/contextmenu/jquery.contextMenu.min.css">
    <link rel="stylesheet" href="../../metro/css/metro-all.css" />

    <script type="text/javascript" src="/serverportal/addons/jquery/jquery-3.6.0.min.js"></script>

    <script type="text/javascript" src="/serverportal/addons/fancytree/dist/fancytree-all-deps.js"></script>
    <script type="text/javascript" src="/serverportal/addons/fancytree/extensions/contextmenu/js/jquery.contextMenu.min.js"></script>
    <script type="text/javascript" src="/serverportal/addons/fancytree/extensions/contextmenu/js/jquery.fancytree.contextMenu.js"></script>
    <script type="text/javascript" src="../../metro/js/metro.min.js"></script>

    <!--GLOBAL FUNCT-->
    <script type="text/javascript" src="/serverportal/manage/js/global-storage.js"></script>
    <script type="text/javascript" src="/serverportal/manage/js/global-behavior.js"></script>
    <script type="text/javascript" src="/serverportal/manage/js/global-object.js"></script>
    <script type="text/javascript" src="/serverportal/manage/js/global-functions.js"></script>
    <script type="text/javascript" src="/serverportal/manage/js/global-api.js"></script>

    <script type="text/javascript" src="/serverportal/manage/js/js.cookie.min.js"></script>
    <script type="text/javascript" src="/serverportal/manage/js/mermaid.min.cdn.js"></script>

    <!--MONACO-->
    <script type="text/javascript" src="/serverportal/addons/monaco/js/monaco-editor/min/vs/loader.js"></script>
    <style>
        .monaco-editor {
            min-width: 100%;
            width: 100%;
            min-height: 100%;
        }
    </style>

    <title>Code Library Browser</title>
</head>
<body>
    <div class="row w-100 h-100 d-inline-flex">
        <div id="DataTree" class="h-100" style="width: 350px; overflow-y: auto; padding-top: 25px;"></div>
        <div id="FrameWindow" class="h-100 row" height="100%" frameborder="0" scrolling="yes" style="width: calc(100% - 350px); height: 100%; position: relative; padding-top: 25px;">
            <div id="userFilesPreview" class='row' style="height: 100%; width: 100%; position: fixed; display: block !important;"></div>
        </div>

        <select class="theme" style='position: absolute;left: 90%;z-index: 2000;top: 30px;right: 0px;'>
            <option>vs-dark</option>
            <option>vs</option>
            <option>hc-black</option>
        </select>

        <select class="language" style='position: absolute;left: 90%;z-index: 2000;top: 60px;right: 0px;'>
            <option>bat</option>
            <option>csharp</option>
            <option>css</option>
            <option>graphql</option>
            <option>handlebars</option>
            <option>html</option>
            <option selected>javascript</option>
            <option>json</option>
            <option>markdown</option>
            <option>mysql</option>
            <option>pgsql</option>
            <option>php</option>
            <option>powerquery</option>
            <option>powershell</option>
            <option>python</option>
            <option>razor</option>
            <option>scheme</option>
            <option>scss</option>
            <option>shell</option>
            <option>sql</option>
            <option>typescript</option>
            <option>vb</option>
            <option>xml</option>
        </select>

        <div id="ActionMenu" class="w-100 pos-fixed">
            <nav data-role="ribbonmenu">
                <ul class="tabs-holder">
                    <li onclick="ReloadUserStorage();" class=""><a href="#">Reload</a></li>
                    <li><a href="#sectionFile">Editors</a></li>
                    <li><a href="#">Download</a></li>
                    <li><a href="#">Media</a></li>
                </ul>
                <div class="content-holder">
                    <div class="section" id="sectionFile">
                        <div class="group">
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-codepen"></span>
                                </span>
                                <span class="caption">Monaco</span>
                            </button>
                            <span class="title">Code Editors</span>
                        </div>
                        <div class="group">
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-table"></span>
                                </span>
                                <span class="caption">TinyMCE</span>
                            </button>
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-flow-tree"></span>
                                </span>
                                <span class="caption">Froala</span>
                            </button>
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-sun3"></span>
                                </span>
                                <span class="caption">Sun</span>
                            </button>
                            <span class="title">Basic HTML Editors</span>
                        </div>

                        <div class="group">
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-air"></span>
                                </span>
                                <span class="caption">Editor JS</span>
                            </button>
                            <button class="ribbon-button">
                                <span class="icon">
                                    <span class="mif-dashboard"></span>
                                </span>
                                <span class="caption">Html Flow</span>
                            </button>
                            <span class="title">Flow HTML Editors</span>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <script>
        async function StartUp() {
            const dataJs = await fetch('/serverportal/addons/monaco/js/userFiles.js').then((r) => r.text())
            new Function(dataJs)();
            InitiateTree();
        }

        function InitiateTree() {
            $("#DataTree").fancytree({
                extensions: ["contextMenu"],
                checkbox: false,
                quicksearch: true,
                source: {
                    url: "/UserStorageService/GetUserStorage"
                },
                activate: function (event, data) {
                    //console.log("activate", event, data, data.node.data.extension);

                    //Show Text Files ServerParam["TextFilesExtensionList"]
                    if (["js", "md", "html", "css", "txt", "json", "svg"].includes(data.node.data.extension)) {
                        Gs.Variables.monacoEditorList.filter(obj => { return obj.elementId == "userFilesPreview" })[0].editor.getModel().setValue(data.node.key);
                    } //Show Binary Files
                    else if (["stl", "mp4", "avi", "mp3", "jpg", "jpeg", "png", "tiff"].includes(data.node.data.extension)) {

                    }
                    //TODO download and replace key with downloaded data and Show
                    //Video Audio, STL, PDF, Images, PDF
                },
                checkbox: function (event, data) {
                    return data.node.isFolder() ? false : false;
                },
                contextMenu: {
                    autoFocus: true,
                    menu: function (node) {
                        if (node.folder) { return {
                                "createFolder": { "name": "Create Folder", "icon": "add" },"moveFolder": { "name": "Move to Folder", "icon": "edit" },
                                "copyFolder": { "name": "Copy to Folder", "icon": "copy" },"clearFolder": { "name": "Clear Folder", "icon": "delete" },
                                "deleteFolder": { "name": "Delete Folder", "icon": "quit" },
                                "sep1": "---------", "downloadFolder": { "name": "Download Folder (Zip)", "icon": "paste" },
                                "sep2": "---------","createFile": { "name": "Create File", "icon": "add" },
                            };
                        } else { return {
                                //"readTextFile": { "name": "Edit Text File", "icon": 'edit' },
                                "saveFile": { "name": "Save File", "icon": "paste" },"moveFile": { "name": "Move to Folder\\File", "icon": "paste" },
                                "copyFile": { "name": "Copy to Folder\\File", "icon": "copy" },"deleteFile": { "name": "Delete File", "icon": "delete" },
                                "sep1": "---------","downloadFile": { "name": "Download File (Zip)", "icon": "paste" },
                                //"readBinaryFile": { "name": "Read Binary File", "icon": 'edit' },
                            };
                        }
                    },
                    actions: function (node, action, options) {
                        if (action == "createFolder") {
                            let content = "<div><input id='FolderName' type='text' data-role='input' data-prepend='Folder Name:' ></div>";
                            let actions = [ { caption: "Create Folder", cls: "js-dialog-close success",
                                    onclick: async function() {
                                        if($("#FolderName").val().length > 0) {
                                                await Gs.Apis.RunServerPostApi("UserStorageService/CreateUserFolder", { Path: $('#DataTree').fancytree("getActiveNode").data.path + "\\" + $("#FolderName").val() }, null, "ReloadUserStorage");
                                        } else { alert("Name must be Inserted"); }
                                    }},{caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { }}]
                            Gs.Objects.CreateDialogRequest("Create Folder", content, actions);

                        } else if (action == "moveFolder") {
                            let content = "<div><input id='FolderName' type='text' data-role='input' data-prepend='Target Folder Name: ' ></div>"
                            let actions = [ { caption: "Move Folder", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        if ($("#FolderName").val().length > 0) {
                                            await Gs.Apis.RunServerPostApi("UserStorageService/MoveUserFolder", { SourcePath: $('#DataTree').fancytree("getActiveNode").data.path, TargetPath: "\\" + $("#FolderName").val() }, null, "ReloadUserStorage");
                                        } else { alert("Name must be Inserted"); }
                                    }},{ caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } }]
                            Gs.Objects.CreateDialogRequest("Move Folder", content, actions);

                        } else if(action == "copyFolder") {
                            let content = "<div><input id='FolderName' type='text' data-role='input' data-prepend='Target Folder Name: ' ></div>";
                            let actions = [ { caption: "Copy Folder", cls: "js-dialog-close success",
                                onclick: async function () {
                                    if ($("#FolderName").val().length > 0) {
                                        await Gs.Apis.RunServerPostApi("UserStorageService/CopyUserFolder", { SourcePath: $('#DataTree').fancytree("getActiveNode").data.path, TargetPath: "\\" + $("#FolderName").val() }, null, "ReloadUserStorage");
                                    } else { alert("Name must be Inserted"); }}
                                },{ caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } }]
                            Gs.Objects.CreateDialogRequest("Copy Folder", content, actions);

                        } else if (action == "downloadFolder") {
                            Gs.Apis.DownloadApi("UserStorageService/DownloadUserFolder", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, $('#DataTree').fancytree("getActiveNode").data.path.split("\\").pop(), true);
                        } else if (action == "clearFolder") {
                            let content = "<div>Do you want to Clear selected Folder? " + $('#DataTree').fancytree("getActiveNode").data.path + "</div>";
                            let actions = [ { caption: "Clear Folder", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        await Gs.Apis.RunServerPostApi("UserStorageService/ClearUserFolder", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, null, "ReloadUserStorage");
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } }]
                            Gs.Objects.CreateDialogRequest("Clear Folder", content, actions);

                        } else if (action == "deleteFolder") {
                            let content = "<div>Do you want to Delete selected Folder? " + $('#DataTree').fancytree("getActiveNode").data.path + "</div>";
                            let actions = [ { caption: "Delete Folder", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        await Gs.Apis.RunServerPostApi("UserStorageService/DeleteUserFolder", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, null, "ReloadUserStorage");
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } } ]
                            Gs.Objects.CreateDialogRequest("Delete Folder", content, actions);

                        } else if (action == "createFile") {
                            let content = "<div><input id='Filename' type='text' data-role='input' data-prepend='Write FileName: ' ></div>";
                            let actions = [ { caption: "Create File", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        if ($("#Filename").val().length > 0) {
                                            await Gs.Apis.RunServerPostApi("UserStorageService/CreateUserFile", { Path: $('#DataTree').fancytree("getActiveNode").data.path, Filename: "\\" + $("#Filename").val() }, null, "ReloadUserStorage");
                                        } else { alert("FileName must be Inserted"); }
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } } ]
                            Gs.Objects.CreateDialogRequest("Create File", content, actions);

                        }
                        //else if (action == "readTextFile") {//NOT USED
                        //    Gs.Apis.DownloadApi("UserStorageService/GetUserTextFile", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, $('#DataTree').fancytree("getActiveNode").data.path.split("\\").pop(), false, "UserTextFile", "SetTextFileToEditor");
                        //}
                        else if (action == "saveFile") {
                            Gs.Apis.RunServerPostApi("UserStorageService/SetUserTextFile", {
                                    Path: $('#DataTree').fancytree("getActiveNode").data.path,
                                    Content: Gs.Variables.monacoEditorList.filter(obj => { return obj.elementId == "userFilesPreview" })[0].model.getValue()
                                    //TODO get From ALL EDITORS
                                }, null, "ReloadUserStorage");
                        } else if (action == "moveFile") {
                            let content = "<div><input id='FileName' type='text' data-role='input' data-prepend='Target Folder\\File Name: ' ></div>";
                            let actions = [ { caption: "Move File", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        if ($("#FileName").val().length > 0) {
                                            await Gs.Apis.RunServerPostApi("UserStorageService/MoveUserFile", { SourcePath: $('#DataTree').fancytree("getActiveNode").data.path, TargetPath: "\\" + $("#FileName").val() }, null, "ReloadUserStorage");
                                        } else { alert("FileName must be Inserted"); }
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } } ]
                            Gs.Objects.CreateDialogRequest("Move File", content, actions);

                        } else if (action == "copyFile") {
                            let content = "<div><input id='FileName' type='text' data-role='input' data-prepend='Target Folder\\File Name: ' ></div>";
                            let actions = [{ caption: "Copy File", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        if ($("#FileName").val().length > 0) {
                                            await Gs.Apis.RunServerPostApi("UserStorageService/CopyUserFile", { SourcePath: $('#DataTree').fancytree("getActiveNode").data.path, TargetPath: "\\" + $("#FileName").val() }, null, "ReloadUserStorage");
                                        } else { alert("Name must be Inserted"); }
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } } ]
                            Gs.Objects.CreateDialogRequest("Copy File", content, actions);

                        } else if (action == "deleteFile") {
                            let content = "<div>Do you want to Delete selected File? " + $('#DataTree').fancytree("getActiveNode").data.path.split("\\").pop() + "</div>";
                            let actions = [ { caption: "Delete File", cls: "js-dialog-close success",
                                    onclick: async function () {
                                        await Gs.Apis.RunServerPostApi("UserStorageService/DeleteUserFile", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, null, "ReloadUserStorage");
                                    } }, { caption: "Cancel", cls: "js-dialog-close alert", onclick: function () { } } ]
                            Gs.Objects.CreateDialogRequest("Delete File", content, actions);

                        } else if (action == "downloadFile") {
                            Gs.Apis.DownloadApi("UserStorageService/DownloadUserFile", { Path: $('#DataTree').fancytree("getActiveNode").data.path }, $('#DataTree').fancytree("getActiveNode").data.path.split("\\").pop(), true);
                        }

                        //console.log("Selected action '" + action + "' on node " + node + "." + $('#DataTree').fancytree("getActiveNode").data);
                    }
                },
            });
        }

        $(document).ready(function () {
            StartUp();
        })

        function ReloadUserStorage() {
            $('#DataTree').fancytree('option', 'source', { url: "/UserStorageService/GetUserStorage" });
        }

        /*
        function SetTextFileToEditor() {
            Gs.Variables.monacoEditorList.filter(obj => { return obj.elementId == "userFilesPreview" })[0].editor.getModel().setValue(Metro.storage.getItem("UserTextFile", null));
        }
        function GetTextFileFromEditor() {
            Metro.storage.setItem("UserTextFile", Gs.Variables.monacoEditorList.filter(obj => { return obj.elementId == "userFilesPreview" })[0].model.getValue());
        }
        */


    </script>

    <!--TYNYMCE-->
    <script type="text/javascript" src="/serverportal/addons/tinymce/tinymce.min.js"></script>
</body>
</html>