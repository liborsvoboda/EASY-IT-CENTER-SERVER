(function(){"use strict";function Ue(e){return typeof e=="function"?{main:e}:e}var q=null;function Ve(e){if(q!=null)throw new Error('Messaging API already set. Likely you called "initPegasusTransport" twice in the same context.');q=e}function ee(){if(q==null)throw new Error(`Messaging API wan't set. Make sure you called "initPegasusTransport" within current context before using @webext-pegasus packages.`);return q}function ze(){const{browser:e}=ee();return e}function We(){const{onBroadcastEvent:e,emitBroadcastEvent:t}=ee();return{emitBroadcastEvent:t,onBroadcastEvent:e}}function qe(){const{onMessage:e,sendMessage:t}=ee();return{onMessage:e,sendMessage:t}}function He(e){return`pegasus-rpc-service.${e}`}var fe=new Set;function me(e,t){if(fe.has(e))throw new Error(`Service ${e} already registered`);const r=He(e),n=t,{onMessage:o}=qe();o(r,({data:l,...a})=>{if(typeof l!="object"||l==null||!("path"in l)||!("args"in l)||!Array.isArray(l.args))throw new Error(`Invalid message received for pegasus-rpc-service "${e}": ${JSON.stringify(l,void 0,2)}`);const s=l.path==null||typeof l.path!="string"?null:l.path,i=s==null?n:n[s];if(typeof i!="function")throw new Error(`Invalid message received for pegasus-rpc-service "${e}": ${s!=null?`Can't find method "${s}`:"Expected service to be a function"}"`);return Promise.resolve(i.bind(t)(a,...l.args))}),fe.add(e)}const Je=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],te=Symbol(".toJSON was called"),Ke=e=>{e[te]=!0;const t=e.toJSON();return delete e[te],t},pe=({from:e,seen:t,to_:r,forceEnumerable:n,maxDepth:o,depth:l})=>{const a=r||(Array.isArray(e)?[]:{});if(t.push(e),l>=o)return a;if(typeof e.toJSON=="function"&&e[te]!==!0)return Ke(e);for(const[s,i]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(i)){a[s]="[object Buffer]";continue}if(i!==null&&typeof i=="object"&&typeof i.pipe=="function"){a[s]="[object Stream]";continue}if(typeof i!="function"){if(!i||typeof i!="object"){a[s]=i;continue}if(!t.includes(e[s])){l++,a[s]=pe({from:e[s],seen:[...t],forceEnumerable:n,maxDepth:o,depth:l});continue}a[s]="[Circular]"}}for(const{property:s,enumerable:i}of Je)typeof e[s]=="string"&&Object.defineProperty(a,s,{value:e[s],enumerable:n?!0:i,configurable:!0,writable:!0});return a};function Ae(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return typeof e=="object"&&e!==null?pe({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}var Ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function H(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var re={exports:{}};const Ze=e=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const t=crypto.getRandomValues(new Uint8Array(1))[0];return(t>=e?t%e:t).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),he=(e=7,t=!1)=>Array.from({length:e},Ze(t?16:36)).join("");re.exports=he,re.exports.default=he;var Ye=re.exports;const U=H(Ye);var Xe=(e,t,r)=>{const n=U(),o=new Map,l=async a=>{const s=a.hops.findIndex(i=>i.startsWith("background::"))!==-1;if(a.origin.context===e||s){const{id:i}=a,m=[],y=o.get(i)??[];for(const b of y)try{await b({data:a.data,id:i,sender:a.origin,timestamp:a.timestamp})}catch(c){m.push(c)}if(m.length>0)throw new Error(`Error(s) occurred while handling broadcast event ${i}: ${m.map(b=>Ae(b)).join(", ")}`);if(s)return}return a.hops.push(`${e}::${n}`),t(a)};return{emitBroadcastEvent:async(a,s)=>{const i={data:s,hops:[],id:a,messageType:"broadcastEvent",origin:{context:e,tabId:null},timestamp:Date.now(),transactionId:U()};return await l(i)},handleEvent:l,onBroadcastEvent:(a,s)=>{const i=o.get(a)??[];return o.set(a,[...i,s]),()=>{const m=o.get(a)??[];o.set(a,m.filter(y=>y!==s))}}}},Qe=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,ye=e=>{const[,t,r,n]=e.match(Qe)||[];return{context:t,frameId:n?+n:void 0,tabId:+r}},J=({context:e,tabId:t,frameId:r})=>["background","popup","options"].includes(e)?e:`${e}@${t}${r?`.${r}`:""}`,et=(e,t,r)=>{const n=U(),o=new Map,l=new Map,a=s=>{if(s.destination.context===e&&!s.destination.frameId&&!s.destination.tabId){r==null||r(s);const{transactionId:i,id:m,messageType:y}=s,b=()=>{const u=o.get(i);if(u){const{err:f,data:S}=s;if(f){const p=f,w=self[p.name],E=new(typeof w=="function"?w:Error)(p.message);for(const M in p)E[M]=p[M];u.reject(E)}else u.resolve(S);o.delete(i)}},c=async()=>{let u=null,f=null,S=!1;try{const p=l.get(m);if(typeof p=="function")u=await p({data:s.data,id:m,sender:s.origin,timestamp:s.timestamp});else throw S=!0,new Error(`[pegasus-transport] No handler registered in '${e}' to accept messages with id '${m}'`)}catch(p){f=p}finally{if(f&&(s.err=Ae(f)),a({...s,data:u,destination:s.origin,hops:[],messageType:"reply",origin:{context:e,tabId:null}}),f&&!S)throw u}};switch(y){case"reply":return b();case"message":return c()}}return s.hops.push(`${e}::${n}`),t(s)};return{endTransaction:s=>{const i=o.get(s);i==null||i.reject("Transaction was ended before it could complete"),o.delete(s)},handleMessage:a,onMessage:(s,i)=>(l.set(s,i),()=>l.delete(s)),sendMessage:(s,i,m="background")=>{const y=typeof m=="string"?ye(m):m,b="Bridge#sendMessage ->";if(!y.context)throw new TypeError(`${b} Destination must be any one of known destinations`);return new Promise((c,u)=>{const f={data:i,destination:y,hops:[],id:s,messageType:"message",origin:{context:e,tabId:null},timestamp:Date.now(),transactionId:U()};o.set(f.transactionId,{reject:u,resolve:c});try{a(f)}catch(S){o.delete(f.transactionId),u(S)}})}}};function tt(e){return e.messageType==="broadcastEvent"}function rt(e){return e.messageType==="message"||e.messageType==="reply"}var V=class{static toBackground(e,t){return e.postMessage(t)}static toExtensionContext(e,t){return e.postMessage(t)}},nt=(e,t=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&t.every(r=>r in e),st=e=>{try{const t=JSON.parse(e);return nt(t)?t:null}catch{return null}},ot=()=>{let e=[];return{add:(...t)=>{e=[...e,...t]},entries:()=>e,remove:t=>{e=typeof t=="string"?e.filter(r=>r.message.transactionId!==t):e.filter(r=>!t.includes(r))}}},it=()=>`uid::${U(7)}`;function at(e,{eventRuntime:t,messageRuntime:r}){if(tt(e))t.handleEvent(e);else if(rt(e))r.handleMessage(e);else throw new TypeError("Unknown message type")}var be={exports:{}};(function(e,t){(function(r,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ge,function(r){var n,o;if(!((o=(n=globalThis.chrome)==null?void 0:n.runtime)!=null&&o.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const l="The message port closed before a response was received.",a=s=>{const i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(i).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class m extends WeakMap{constructor(g,x=void 0){super(x),this.createItem=g}get(g){return this.has(g)||this.set(g,this.createItem(g)),super.get(g)}}const y=d=>d&&typeof d=="object"&&typeof d.then=="function",b=(d,g)=>(...x)=>{s.runtime.lastError?d.reject(new Error(s.runtime.lastError.message)):g.singleCallbackArg||x.length<=1&&g.singleCallbackArg!==!1?d.resolve(x[0]):d.resolve(x)},c=d=>d==1?"argument":"arguments",u=(d,g)=>function(v,...R){if(R.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${c(g.minArgs)} for ${d}(), got ${R.length}`);if(R.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${c(g.maxArgs)} for ${d}(), got ${R.length}`);return new Promise((P,C)=>{if(g.fallbackToNoCallback)try{v[d](...R,b({resolve:P,reject:C},g))}catch(h){console.warn(`${d} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,h),v[d](...R),g.fallbackToNoCallback=!1,g.noCallback=!0,P()}else g.noCallback?(v[d](...R),P()):v[d](...R,b({resolve:P,reject:C},g))})},f=(d,g,x)=>new Proxy(g,{apply(v,R,P){return x.call(R,d,...P)}});let S=Function.call.bind(Object.prototype.hasOwnProperty);const p=(d,g={},x={})=>{let v=Object.create(null),R={has(C,h){return h in d||h in v},get(C,h,$){if(h in v)return v[h];if(!(h in d))return;let k=d[h];if(typeof k=="function")if(typeof g[h]=="function")k=f(d,d[h],g[h]);else if(S(x,h)){let L=u(h,x[h]);k=f(d,d[h],L)}else k=k.bind(d);else if(typeof k=="object"&&k!==null&&(S(g,h)||S(x,h)))k=p(k,g[h],x[h]);else if(S(x,"*"))k=p(k,g[h],x["*"]);else return Object.defineProperty(v,h,{configurable:!0,enumerable:!0,get(){return d[h]},set(L){d[h]=L}}),k;return v[h]=k,k},set(C,h,$,k){return h in v?v[h]=$:d[h]=$,!0},defineProperty(C,h,$){return Reflect.defineProperty(v,h,$)},deleteProperty(C,h){return Reflect.deleteProperty(v,h)}},P=Object.create(d);return new Proxy(P,R)},w=d=>({addListener(g,x,...v){g.addListener(d.get(x),...v)},hasListener(g,x){return g.hasListener(d.get(x))},removeListener(g,x){g.removeListener(d.get(x))}}),E=new m(d=>typeof d!="function"?d:function(x){const v=p(x,{},{getContent:{minArgs:0,maxArgs:0}});d(v)}),M=new m(d=>typeof d!="function"?d:function(x,v,R){let P=!1,C,h=new Promise(W=>{C=function(N){P=!0,W(N)}}),$;try{$=d(x,v,C)}catch(W){$=Promise.reject(W)}const k=$!==!0&&y($);if($!==!0&&!k&&!P)return!1;const L=W=>{W.then(N=>{R(N)},N=>{let de;N&&(N instanceof Error||typeof N.message=="string")?de=N.message:de="An unexpected error occurred",R({__mozWebExtensionPolyfillReject__:!0,message:de})}).catch(N=>{console.error("Failed to send onMessage rejected reply",N)})};return L(k?$:h),!0}),I=({reject:d,resolve:g},x)=>{s.runtime.lastError?s.runtime.lastError.message===l?g():d(new Error(s.runtime.lastError.message)):x&&x.__mozWebExtensionPolyfillReject__?d(new Error(x.message)):g(x)},T=(d,g,x,...v)=>{if(v.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${c(g.minArgs)} for ${d}(), got ${v.length}`);if(v.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${c(g.maxArgs)} for ${d}(), got ${v.length}`);return new Promise((R,P)=>{const C=I.bind(null,{resolve:R,reject:P});v.push(C),x.sendMessage(...v)})},j={devtools:{network:{onRequestFinished:w(E)}},runtime:{onMessage:w(M),onMessageExternal:w(M),sendMessage:T.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:T.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},B={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":B},services:{"*":B},websites:{"*":B}},p(s,j,i)};r.exports=a(chrome)}else r.exports=globalThis.browser})})(be);var ct=be.exports;const ne=H(ct);function ut(){const e=ot(),t=new Map,r=new Map,n=new Map,o=(c,u)=>(r.set(c,(r.get(c)||new Set).add(u)),()=>{const f=r.get(c);f!=null&&f.delete(u)&&(f==null?void 0:f.size)===0&&r.delete(c)}),l=(c,u)=>{n.set(c,(n.get(c)||new Set).add(u))},a=c=>({withFingerprint:u=>{const f=p=>({and:()=>p}),S={aboutIncomingMessage:p=>{const w=t.get(c);if(w==null)throw new Error("Unable to find recipient endpoint");return V.toExtensionContext(w.port,{message:p,status:"incoming"}),f(S)},aboutMessageUndeliverability:(p,w)=>{const E=t.get(c);return(E==null?void 0:E.fingerprint)===u&&V.toExtensionContext(E.port,{message:w,resolvedDestination:p,status:"undeliverable"}),f(S)},aboutSessionEnded:p=>{const w=t.get(c);return(w==null?void 0:w.fingerprint)===u&&V.toExtensionContext(w.port,{fingerprint:p,status:"terminated"}),f(S)},aboutSuccessfulDelivery:p=>{const w=t.get(c);if(w==null)throw new Error("Unable to find sender endpoint");return V.toExtensionContext(w.port,{receipt:p,status:"delivered"}),f(S)},whenDeliverableTo:p=>{const w=()=>{const E=t.get(c);if((E==null?void 0:E.fingerprint)===u&&t.has(p))return V.toExtensionContext(E.port,{deliverableTo:p,status:"deliverable"}),!0};if(!w()){const E=o(p,w);l(u,E)}return f(S)}};return S}}),s=it(),i=et("background",async c=>{var E;if(c.origin.context==="background"&&["content-script","devtools"].includes(c.destination.context)&&!c.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const u=J({...c.origin,...c.origin.context==="window"&&{context:"content-script"}}),f=J({...c.destination,...c.destination.context==="window"&&{context:"content-script"},tabId:c.destination.tabId||c.origin.tabId});c.destination.tabId=null,c.destination.frameId=void 0;const S=()=>t.get(f),p=()=>t.get(u),w=()=>{var I;a(f).withFingerprint(S().fingerprint).aboutIncomingMessage(c);const M={from:{endpointId:u,fingerprint:(I=p())==null?void 0:I.fingerprint},message:c,to:S().fingerprint};c.messageType==="message"&&e.add(M),c.messageType==="reply"&&e.remove(c.id),p()&&a(u).withFingerprint(p().fingerprint).aboutSuccessfulDelivery(M)};(E=S())!=null&&E.port?w():c.messageType==="message"&&(c.origin.context==="background"?o(f,w):p()&&a(u).withFingerprint(p().fingerprint).aboutMessageUndeliverability(f,c).and().whenDeliverableTo(f))},async c=>{const u=J({...c.origin,...c.origin.context==="window"&&{context:"content-script"}}),f=t.get(u);if(f==null)throw new Error("Unable to find sender endpoint");const S={from:{endpointId:u,fingerprint:f.fingerprint},message:c,to:s};a(u).withFingerprint(f.fingerprint).aboutSuccessfulDelivery(S)});ne.runtime.onConnect.addListener(c=>{var p,w,E,M;const u=st(c.name);if(!u)return;u.endpointName||(u.endpointName=J({context:"content-script",frameId:(p=c.sender)==null?void 0:p.frameId,tabId:((E=(w=c.sender)==null?void 0:w.tab)==null?void 0:E.id)??null}));const{tabId:f,frameId:S}=ye(u.endpointName);t.set(u.endpointName,{fingerprint:u.fingerprint,port:c}),(M=r.get(u.endpointName))==null||M.forEach(I=>I()),r.delete(u.endpointName),l(u.fingerprint,()=>{const I=e.entries().filter(T=>T.to===u.fingerprint);e.remove(I),I.forEach(T=>{T.from.endpointId==="background"?i.endTransaction(T.message.transactionId):a(T.from.endpointId).withFingerprint(T.from.fingerprint).aboutSessionEnded(u.fingerprint)})}),c.onDisconnect.addListener(()=>{var I,T;((I=t.get(u.endpointName))==null?void 0:I.fingerprint)===u.fingerprint&&t.delete(u.endpointName),(T=n.get(u.fingerprint))==null||T.forEach(j=>j()),n.delete(u.fingerprint)}),c.onMessage.addListener(I=>{var T,j;if(I.type==="sync"){const B=[...t.values()].map(g=>g.fingerprint),d=I.pendingResponses.filter(g=>B.includes(g.to));e.add(...d),I.pendingResponses.filter(g=>!B.includes(g.to)).forEach(g=>a(u.endpointName).withFingerprint(u.fingerprint).aboutSessionEnded(g.to)),I.pendingDeliveries.forEach(g=>a(u.endpointName).withFingerprint(u.fingerprint).whenDeliverableTo(g));return}I.type==="deliver"&&((j=(T=I.message)==null?void 0:T.origin)!=null&&j.context)&&(I.message.origin.tabId=f,I.message.origin.frameId=S,at(I.message,{eventRuntime:b,messageRuntime:i}))})});let m=[];setTimeout(()=>{Promise.all(m.map(y)).catch(c=>{console.error("Error while tying to deliver undelivered events:",c)}),m=void 0},500);const y=async c=>{if(t.size===0&&m!==void 0){m.push(c);return}t.forEach((u,f)=>{a(f).withFingerprint(u.fingerprint).aboutIncomingMessage(c)}),c.origin.context!=="background"&&b.handleEvent(c)},b=Xe("background",y);Ve({browser:ne,emitBroadcastEvent:b.emitBroadcastEvent,onBroadcastEvent:b.onBroadcastEvent,onMessage:i.onMessage,sendMessage:i.sendMessage})}var lt=class{constructor(e,t,r){this.store=e,this.serializer=t,this.deserializer=r}fetchState(e){const t=this.store.getState();return this.serializer(t)}async dispatch(e,t){return this.serializer(await this.store.dispatch(this.deserializer(t)))}},gt=class{constructor(e,t,r,n){this.storeName=e,this.storageStrategy=t,this.serializer=r,this.deserializer=n;const o=ze();if(o===null)throw new Error("Browser API not available");this.browser=o}async getState(){if(this.storageStrategy===void 0)return;this.checkPermissions();const e=this.getStorageKey(),{[e]:t}=await this.getStoreStorage().get(e).catch(n=>(console.error(`Error loading Pegasus Store "${this.storeName}" state from storage.`,n),{[e]:void 0}));let r;if(typeof t=="string")try{r=this.deserializer(t)}catch(n){console.warn("Error deserializing preloaded state:",n,t)}return r}async setState(e){if(this.storageStrategy===void 0)return;this.checkPermissions();const t=this.getStorageKey();await this.getStoreStorage().set({[t]:this.serializer(e)}).catch(r=>{console.error(`Error saving Pegasus Store "${this.storeName}" state to storage.`,r)})}getStorageKey(){return`pegasus-store/${this.storeName}`}getStoreStorage(){const e=this.storageStrategy??"session";return this.browser.storage[e]}checkPermissions(){if(this.browser.storage===void 0)throw new Error('Error initializing storage for Pegasus Store, ensure that you have "storage" permission enabled for your extension.')}};function xe(e){return typeof e=="object"&&e!==null}function dt(e,t){if(!xe(e)||!xe(t))throw new Error("shallowDiff can only diff valid state objects");const r=[];return Object.keys(t).forEach(n=>{e[n]!==t[n]&&r.push({change:"updated",key:n,value:t[n]})}),Object.keys(e).forEach(n=>{t.hasOwnProperty(n)||r.push({change:"removed",key:n})}),r}async function ft(e,{portName:t,serializer:r,deserializer:n,diffStrategy:o=dt,storageStrategy:l}){const{emitBroadcastEvent:a}=We(),s=new gt(t,l,r,n),i=e(await s.getState());me(`PegasusStoreCommunicationBridgeFor-${t}`,new lt(i,r,n));let m=i.getState();return i.subscribe(()=>{const y=i.getState(),b=o(m,y);b.length&&(m=y,a(`pegasusStore/${t}/chromex.patch_state`,r(b)).catch(c=>{console.error(`Error emitting patch state event for Pegasus Store "${t}"`,c)}),s.setState(y))}),a(`pegasusStore/${t}/chromex.state`,r(m)).catch(y=>{console.error(`Error emitting initial state event for Pegasus Store "${t}"`,y)}),i}function mt(){return{deserializer:r=>JSON.parse(r),serializer:r=>JSON.stringify(r)}}async function pt(e,t,r={}){return await ft(n=>(n!==void 0&&t.setState(n),{async dispatch(o){return o.type!=="__ZUSTAND_SYNC__"?(console.warn("Unexpected action type:",o.type),o):(t.setState(o.state),o)},getState:t.getState,subscribe:t.subscribe}),{...r,...mt(),portName:e}),t}var At={VITE_CJS_IGNORE_WARNING:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,MANIFEST_VERSION:3,BROWSER:"chrome",CHROME:!0,FIREFOX:!1,SAFARI:!1,EDGE:!1,OPERA:!1,COMMAND:"build",ENTRYPOINT:"background"};const Se=e=>{let t;const r=new Set,n=(y,b)=>{const c=typeof y=="function"?y(t):y;if(!Object.is(c,t)){const u=t;t=b??(typeof c!="object"||c===null)?c:Object.assign({},t,c),r.forEach(f=>f(t,u))}},o=()=>t,i={setState:n,getState:o,getInitialState:()=>m,subscribe:y=>(r.add(y),()=>r.delete(y)),destroy:()=>{(At?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},m=t=e(n,o,i);return i},ht=e=>e?Se(e):Se;var we={exports:{}},A={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z=Symbol.for("react.element"),yt=Symbol.for("react.portal"),bt=Symbol.for("react.fragment"),xt=Symbol.for("react.strict_mode"),St=Symbol.for("react.profiler"),wt=Symbol.for("react.provider"),vt=Symbol.for("react.context"),Et=Symbol.for("react.forward_ref"),It=Symbol.for("react.suspense"),kt=Symbol.for("react.memo"),Rt=Symbol.for("react.lazy"),ve=Symbol.iterator;function _t(e){return e===null||typeof e!="object"?null:(e=ve&&e[ve]||e["@@iterator"],typeof e=="function"?e:null)}var Ee={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ie=Object.assign,ke={};function F(e,t,r){this.props=e,this.context=t,this.refs=ke,this.updater=r||Ee}F.prototype.isReactComponent={},F.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},F.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Re(){}Re.prototype=F.prototype;function se(e,t,r){this.props=e,this.context=t,this.refs=ke,this.updater=r||Ee}var oe=se.prototype=new Re;oe.constructor=se,Ie(oe,F.prototype),oe.isPureReactComponent=!0;var _e=Array.isArray,Te=Object.prototype.hasOwnProperty,ie={current:null},Pe={key:!0,ref:!0,__self:!0,__source:!0};function Ce(e,t,r){var n,o={},l=null,a=null;if(t!=null)for(n in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(l=""+t.key),t)Te.call(t,n)&&!Pe.hasOwnProperty(n)&&(o[n]=t[n]);var s=arguments.length-2;if(s===1)o.children=r;else if(1<s){for(var i=Array(s),m=0;m<s;m++)i[m]=arguments[m+2];o.children=i}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)o[n]===void 0&&(o[n]=s[n]);return{$$typeof:z,type:e,key:l,ref:a,props:o,_owner:ie.current}}function Tt(e,t){return{$$typeof:z,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ae(e){return typeof e=="object"&&e!==null&&e.$$typeof===z}function Pt(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var $e=/\/+/g;function ce(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Pt(""+e.key):t.toString(36)}function K(e,t,r,n,o){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(l){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case z:case yt:a=!0}}if(a)return a=e,o=o(a),e=n===""?"."+ce(a,0):n,_e(o)?(r="",e!=null&&(r=e.replace($e,"$&/")+"/"),K(o,t,r,"",function(m){return m})):o!=null&&(ae(o)&&(o=Tt(o,r+(!o.key||a&&a.key===o.key?"":(""+o.key).replace($e,"$&/")+"/")+e)),t.push(o)),1;if(a=0,n=n===""?".":n+":",_e(e))for(var s=0;s<e.length;s++){l=e[s];var i=n+ce(l,s);a+=K(l,t,r,i,o)}else if(i=_t(e),typeof i=="function")for(e=i.call(e),s=0;!(l=e.next()).done;)l=l.value,i=n+ce(l,s++),a+=K(l,t,r,i,o);else if(l==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function G(e,t,r){if(e==null)return e;var n=[],o=0;return K(e,n,"","",function(l){return t.call(r,l,o++)}),n}function Ct(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var _={current:null},Z={transition:null},$t={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:Z,ReactCurrentOwner:ie};A.Children={map:G,forEach:function(e,t,r){G(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return G(e,function(){t++}),t},toArray:function(e){return G(e,function(t){return t})||[]},only:function(e){if(!ae(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},A.Component=F,A.Fragment=bt,A.Profiler=St,A.PureComponent=se,A.StrictMode=xt,A.Suspense=It,A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$t,A.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Ie({},e.props),o=e.key,l=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,a=ie.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(i in t)Te.call(t,i)&&!Pe.hasOwnProperty(i)&&(n[i]=t[i]===void 0&&s!==void 0?s[i]:t[i])}var i=arguments.length-2;if(i===1)n.children=r;else if(1<i){s=Array(i);for(var m=0;m<i;m++)s[m]=arguments[m+2];n.children=s}return{$$typeof:z,type:e.type,key:o,ref:l,props:n,_owner:a}},A.createContext=function(e){return e={$$typeof:vt,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:wt,_context:e},e.Consumer=e},A.createElement=Ce,A.createFactory=function(e){var t=Ce.bind(null,e);return t.type=e,t},A.createRef=function(){return{current:null}},A.forwardRef=function(e){return{$$typeof:Et,render:e}},A.isValidElement=ae,A.lazy=function(e){return{$$typeof:Rt,_payload:{_status:-1,_result:e},_init:Ct}},A.memo=function(e,t){return{$$typeof:kt,type:e,compare:t===void 0?null:t}},A.startTransition=function(e){var t=Z.transition;Z.transition={};try{e()}finally{Z.transition=t}},A.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},A.useCallback=function(e,t){return _.current.useCallback(e,t)},A.useContext=function(e){return _.current.useContext(e)},A.useDebugValue=function(){},A.useDeferredValue=function(e){return _.current.useDeferredValue(e)},A.useEffect=function(e,t){return _.current.useEffect(e,t)},A.useId=function(){return _.current.useId()},A.useImperativeHandle=function(e,t,r){return _.current.useImperativeHandle(e,t,r)},A.useInsertionEffect=function(e,t){return _.current.useInsertionEffect(e,t)},A.useLayoutEffect=function(e,t){return _.current.useLayoutEffect(e,t)},A.useMemo=function(e,t){return _.current.useMemo(e,t)},A.useReducer=function(e,t,r){return _.current.useReducer(e,t,r)},A.useRef=function(e){return _.current.useRef(e)},A.useState=function(e){return _.current.useState(e)},A.useSyncExternalStore=function(e,t,r){return _.current.useSyncExternalStore(e,t,r)},A.useTransition=function(){return _.current.useTransition()},A.version="18.2.0",we.exports=A;var ue=we.exports;const Mt=H(ue);var Me={exports:{}},Oe={},Ne={exports:{}},Fe={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D=ue;function Ot(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Nt=typeof Object.is=="function"?Object.is:Ot,Ft=D.useState,Dt=D.useEffect,jt=D.useLayoutEffect,Bt=D.useDebugValue;function Lt(e,t){var r=t(),n=Ft({inst:{value:r,getSnapshot:t}}),o=n[0].inst,l=n[1];return jt(function(){o.value=r,o.getSnapshot=t,le(o)&&l({inst:o})},[e,r,t]),Dt(function(){return le(o)&&l({inst:o}),e(function(){le(o)&&l({inst:o})})},[e]),Bt(r),r}function le(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Nt(e,r)}catch{return!0}}function Ut(e,t){return t()}var Vt=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ut:Lt;Fe.useSyncExternalStore=D.useSyncExternalStore!==void 0?D.useSyncExternalStore:Vt,Ne.exports=Fe;var zt=Ne.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y=ue,Wt=zt;function qt(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ht=typeof Object.is=="function"?Object.is:qt,Jt=Wt.useSyncExternalStore,Kt=Y.useRef,Gt=Y.useEffect,Zt=Y.useMemo,Yt=Y.useDebugValue;Oe.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var l=Kt(null);if(l.current===null){var a={hasValue:!1,value:null};l.current=a}else a=l.current;l=Zt(function(){function i(u){if(!m){if(m=!0,y=u,u=n(u),o!==void 0&&a.hasValue){var f=a.value;if(o(f,u))return b=f}return b=u}if(f=b,Ht(y,u))return f;var S=n(u);return o!==void 0&&o(f,S)?f:(y=u,b=S)}var m=!1,y,b,c=r===void 0?null:r;return[function(){return i(t())},c===null?void 0:function(){return i(c())}]},[t,r,n,o]);var s=Jt(e,l[0],l[1]);return Gt(function(){a.hasValue=!0,a.value=s},[s]),Yt(s),s},Me.exports=Oe;var Xt=Me.exports;const Qt=H(Xt);var De={VITE_CJS_IGNORE_WARNING:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,MANIFEST_VERSION:3,BROWSER:"chrome",CHROME:!0,FIREFOX:!1,SAFARI:!1,EDGE:!1,OPERA:!1,COMMAND:"build",ENTRYPOINT:"background"};const{useDebugValue:er}=Mt,{useSyncExternalStoreWithSelector:tr}=Qt;let je=!1;const rr=e=>e;function nr(e,t=rr,r){(De?"production":void 0)!=="production"&&r&&!je&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),je=!0);const n=tr(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return er(n),n}const Be=e=>{(De?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?ht(e):e,r=(n,o)=>nr(t,n,o);return Object.assign(r,t),r},sr=e=>e?Be(e):Be,or=e=>(t,r,n)=>{const o=n.subscribe;return n.subscribe=(a,s,i)=>{let m=a;if(s){const y=(i==null?void 0:i.equalityFn)||Object.is;let b=a(n.getState());m=c=>{const u=a(c);if(!y(b,u)){const f=b;s(b=u,f)}},i!=null&&i.fireImmediately&&s(b,b)}return o(m)},e(t,r,n)},Le=sr()(or(e=>({isSelecting:{},lexicalState:{},markTabAsRestricted:t=>e(r=>({lexicalState:{...r.lexicalState,[t]:null}})),selectedEditorKey:{},setIsSelecting:(t,r)=>e(n=>({isSelecting:{...n.isSelecting,[t]:r}})),setSelectedEditorKey:(t,r)=>e(n=>({selectedEditorKey:{...n.selectedEditorKey,[t]:r}})),setStatesForTab:(t,r)=>e(n=>({lexicalState:{...n.lexicalState,[t]:r}}))}))),ir="ExtensionStore",ar=()=>pt(ir,Le,{storageStrategy:"session"});var O=ne;const X=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",cr=X&&"documentMode"in document?document.documentMode:null,ur=X&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);X&&"InputEvent"in window&&!cr&&"getTargetRanges"in new window.InputEvent("input");const lr=X&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent);class ge{constructor(t){this.extensionStore=t}static async start(t){return new ge(t).init()}async init(){const t=await O.tabs.query({});await Promise.all(t.map(this.checkAndHandleRestrictedPageIfSo.bind(this))),O.tabs.onCreated.addListener(r=>{this.checkAndHandleRestrictedPageIfSo(r)}),O.tabs.onUpdated.addListener(this.handleTabsUpdatedEvent.bind(this))}async setIcon(t,r){await(ur||lr?O.browserAction:O.action).setIcon({path:{128:O.runtime.getURL(t==="enabled"?"/icon/128.png":"/icon/128-restricted.png"),16:O.runtime.getURL(t==="enabled"?"/icon/16.png":"/icon/16-restricted.png"),32:O.runtime.getURL(t==="enabled"?"/icon/32.png":"/icon/32-restricted.png"),48:O.runtime.getURL(t==="enabled"?"/icon/48.png":"/icon/48-restricted.png")},tabId:r}),t==="restricted"&&this.extensionStore.getState().markTabAsRestricted(r)}handleTabsUpdatedEvent(t,r,n){this.checkAndHandleRestrictedPageIfSo(n)}isRestrictedBrowserPage(t){return!t||["chrome:","about:","file:","edge:"].includes(new URL(t).protocol)}async checkAndHandleRestrictedPageIfSo(t){if(t.id!=null)return t.id==null||this.isRestrictedBrowserPage(t.url)?this.setIcon("restricted",t.id):this.setIcon("enabled",t.id)}}async function gr(e){let t=e.sender.tabId;if(e.sender.context==="popup"&&(t=(await O.tabs.query({active:!0,currentWindow:!0}))[0].id),t===void 0)throw new Error(`Could not get tab ID for message: ${e.toString()}`);return t}const dr=Ue(()=>{ut(),me("getTabID",gr),ar().catch(e=>console.error("Failed to initialize extension store",e)),ge.start(Le).catch(console.error)});function Q(e,...t){}var fr={debug:(...e)=>Q(console.debug,...e),log:(...e)=>Q(console.log,...e),warn:(...e)=>Q(console.warn,...e),error:(...e)=>Q(console.error,...e)};try{dr.main()instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw fr.error("The background crashed on startup!"),e}})();
